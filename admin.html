<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - ToolSpace.lk</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #e6f0ff, #ffffff);
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      padding: 1rem;
      background-color: #003366;
      color: white;
      margin: 0;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      background-color: #00509e;
      padding: 1rem;
      flex-wrap: wrap;
    }

    nav button {
      padding: 0.7rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background-color: #f0f8ff;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: 500;
    }

    nav button:hover {
      background-color: #dceeff;
    }

    nav button.active {
      background-color: #003366;
      color: white;
    }

    #admin-content {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      border-left: 4px solid #00509e;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #003366;
      display: block;
    }

    .stat-label {
      color: #666;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .section-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .section-header {
      background: #f8fafc;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .section-header h2 {
      margin: 0;
      color: #1f2937;
      font-size: 1.3rem;
    }

    .section-content {
      padding: 1.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #e5e7eb;
      padding: 0.75rem;
      text-align: left;
    }

    th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }

    tbody tr:hover {
      background-color: #f3f4f6;
    }

    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-active {
      background-color: #d1fae5;
      color: #065f46;
    }

    .status-ongoing {
      background-color: #dbeafe;
      color: #1e40af;
    }

    .status-returned {
      background-color: #e5e7eb;
      color: #374151;
    }

    .status-completed {
      background-color: #fef3c7;
      color: #92400e;
    }

    .role-admin {
      background-color: #fef2f2;
      color: #dc2626;
    }

    .role-customer {
      background-color: #ecfdf5;
      color: #059669;
    }

    .empty-state {
      text-align: center;
      color: #6b7280;
      padding: 2rem;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .btn-edit {
      background-color: #3b82f6;
      color: white;
    }

    .btn-edit:hover {
      background-color: #2563eb;
    }

    .btn-delete {
      background-color: #ef4444;
      color: white;
    }

    .btn-delete:hover {
      background-color: #dc2626;
    }

    .search-filter {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
    }

    .filter-select {
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      background: white;
    }

    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        align-items: center;
      }

      nav button {
        width: 100%;
        max-width: 200px;
      }

      #admin-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.9rem;
      }

      th, td {
        padding: 0.5rem;
      }

      .search-filter {
        flex-direction: column;
      }

      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <h1>üîß ToolSpace.lk - Admin Dashboard</h1>
  <nav>
    <button onclick="showOverview()" id="overviewBtn" class="active">üìä Overview</button>
    <button onclick="viewUsers()" id="usersBtn">üë• Users</button>
    <button onclick="viewItems()" id="itemsBtn">üîß Tools</button>
    <button onclick="viewRentals()" id="rentalsBtn">üìã Rentals</button>
    <button onclick="viewRegistrations()" id="registrationsBtn">üìù Registrations</button>
    <button onclick="logout()">üö™ Logout</button>
  </nav>
  <div id="admin-content"></div>

  <script>
    // Utility functions
    function setActiveButton(activeId) {
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(activeId).classList.add('active');
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    function getRegisteredUsers() {
      try {
        return JSON.parse(localStorage.getItem("registeredUsers")) || [];
      } catch (e) {
        console.error('Error loading registered users:', e);
        return [];
      }
    }

    function getCurrentRentals() {
      try {
        return JSON.parse(localStorage.getItem("currentRentals")) || [];
      } catch (e) {
        console.error('Error loading rentals:', e);
        return [];
      }
    }

    function getAllTools() {
      return [
        { id: 1, name: "Electric Drill", category: "Power Tools", price: 1000, stock: 10, available: 8 },
        { id: 2, name: "Angle Grinder", category: "Power Tools", price: 1800, stock: 5, available: 4 },
        { id: 3, name: "Circular Saw", category: "Power Tools", price: 2200, stock: 3, available: 3 },
        { id: 4, name: "Jigsaw", category: "Power Tools", price: 1500, stock: 4, available: 4 },
        { id: 5, name: "Impact Driver", category: "Power Tools", price: 1200, stock: 6, available: 5 },
        { id: 9, name: "Hammer", category: "Hand Tools", price: 300, stock: 25, available: 22 },
        { id: 10, name: "Screwdriver Set", category: "Hand Tools", price: 250, stock: 15, available: 15 },
        { id: 16, name: "Chainsaw", category: "Garden & Outdoor", price: 2500, stock: 2, available: 1 },
        { id: 23, name: "Step Ladder", category: "Access Equipment", price: 700, stock: 8, available: 6 },
        { id: 29, name: "Concrete Mixer", category: "Construction Equipment", price: 3500, stock: 1, available: 0 }
      ];
    }

    function getSystemUsers() {
      const registeredUsers = getRegisteredUsers();
      const systemUsers = [
        { username: "admin", role: "Admin", email: "admin@toolspace.lk", joinDate: "2024-01-01", status: "Active" },
        { username: "customer", role: "Customer", email: "customer@toolspace.lk", joinDate: "2024-01-15", status: "Active" }
      ];
      
      // Add registered users
      registeredUsers.forEach(user => {
        systemUsers.push({
          username: user.username,
          role: "Customer",
          email: user.email,
          joinDate: new Date().toISOString().split('T')[0],
          status: "Active"
        });
      });
      
      return systemUsers;
    }

    // Overview Dashboard
    function showOverview() {
      setActiveButton('overviewBtn');
      const users = getSystemUsers();
      const tools = getAllTools();
      const rentals = getCurrentRentals();
      const registrations = getRegisteredUsers();

      const totalRevenue = rentals.reduce((sum, rental) => {
        return sum + (rental.totalAmount || 0);
      }, 0);

      const activeRentals = rentals.filter(rental => rental.status === 'ongoing').length;
      const availableTools = tools.reduce((sum, tool) => sum + tool.available, 0);
      const totalTools = tools.reduce((sum, tool) => sum + tool.stock, 0);

      document.getElementById('admin-content').innerHTML = `
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-number">${users.length}</span>
            <div class="stat-label">Total Users</div>
          </div>
          <div class="stat-card">
            <span class="stat-number">${tools.length}</span>
            <div class="stat-label">Tool Types</div>
          </div>
          <div class="stat-card">
            <span class="stat-number">${availableTools}/${totalTools}</span>
            <div class="stat-label">Available Tools</div>
          </div>
          <div class="stat-card">
            <span class="stat-number">${activeRentals}</span>
            <div class="stat-label">Active Rentals</div>
          </div>
          <div class="stat-card">
            <span class="stat-number">Rs. ${totalRevenue.toLocaleString()}</span>
            <div class="stat-label">Total Revenue</div>
          </div>
          <div class="stat-card">
            <span class="stat-number">${registrations.length}</span>
            <div class="stat-label">New Registrations</div>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2>üìà Recent Activity</h2>
          </div>
          <div class="section-content">
            ${rentals.length > 0 ? `
              <p><strong>Latest Rentals:</strong></p>
              <ul>
                ${rentals.slice(-3).reverse().map(rental => `
                  <li>${rental.customerName || rental.customer} rented ${rental.itemName || rental.item} - ${rental.status}</li>
                `).join('')}
              </ul>
            ` : '<p>No rental activity yet.</p>'}
            
            ${registrations.length > 0 ? `
              <p><strong>Recent Registrations:</strong></p>
              <ul>
                ${registrations.slice(-3).reverse().map(user => `
                  <li>New user: ${user.username} (${user.email})</li>
                `).join('')}
              </ul>
            ` : '<p>No new registrations.</p>'}
          </div>
        </div>
      `;
    }

    // Users Management
    function viewUsers() {
      setActiveButton('usersBtn');
      const users = getSystemUsers();

      let html = `
        <div class="section-card">
          <div class="section-header">
            <h2>üë• User Management</h2>
          </div>
          <div class="section-content">
            <div class="search-filter">
              <input type="text" class="search-input" placeholder="Search users..." onkeyup="filterUsers(this.value)">
              <select class="filter-select" onchange="filterUsersByRole(this.value)">
                <option value="">All Roles</option>
                <option value="Admin">Admin</option>
                <option value="Customer">Customer</option>
              </select>
            </div>
      `;

      if (users.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-state-icon">üë•</div>
            <p>No users found</p>
          </div>
        `;
      } else {
        html += `
          <table id="usersTable">
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Join Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        users.forEach(user => {
          html += `
            <tr>
              <td>${user.username}</td>
              <td>${user.email}</td>
              <td><span class="status-badge ${user.role === 'Admin' ? 'role-admin' : 'role-customer'}">${user.role}</span></td>
              <td>${formatDate(user.joinDate)}</td>
              <td><span class="status-badge status-${user.status.toLowerCase()}">${user.status}</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn-small btn-edit" onclick="editUser('${user.username}')">Edit</button>
                  ${user.username !== 'admin' ? `<button class="btn-small btn-delete" onclick="deleteUser('${user.username}')">Delete</button>` : ''}
                </div>
              </td>
            </tr>
          `;
        });
        
        html += `
            </tbody>
          </table>
        `;
      }

      html += `
          </div>
        </div>
      `;

      document.getElementById('admin-content').innerHTML = html;
    }

    // Tools Management
    function viewItems() {
      setActiveButton('itemsBtn');
      const tools = getAllTools();

      let html = `
        <div class="section-card">
          <div class="section-header">
            <h2>üîß Tools Management</h2>
          </div>
          <div class="section-content">
            <div class="search-filter">
              <input type="text" class="search-input" placeholder="Search tools..." onkeyup="filterTools(this.value)">
              <select class="filter-select" onchange="filterToolsByCategory(this.value)">
                <option value="">All Categories</option>
                <option value="Power Tools">Power Tools</option>
                <option value="Hand Tools">Hand Tools</option>
                <option value="Garden & Outdoor">Garden & Outdoor</option>
                <option value="Access Equipment">Access Equipment</option>
                <option value="Construction Equipment">Construction Equipment</option>
              </select>
            </div>
            <table id="toolsTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Price/Day</th>
                  <th>Total Stock</th>
                  <th>Available</th>
                  <th>Rented</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
      `;

      tools.forEach(tool => {
        const rented = tool.stock - tool.available;
        const availabilityClass = tool.available === 0 ? 'status-returned' : 
                                 tool.available < 3 ? 'status-ongoing' : 'status-active';
        
        html += `
          <tr>
            <td><strong>${tool.name}</strong></td>
            <td>${tool.category}</td>
            <td>Rs. ${tool.price.toLocaleString()}</td>
            <td>${tool.stock}</td>
            <td><span class="status-badge ${availabilityClass}">${tool.available}</span></td>
            <td>${rented}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-small btn-edit" onclick="editTool(${tool.id})">Edit</button>
                <button class="btn-small btn-delete" onclick="deleteTool(${tool.id})">Delete</button>
              </div>
            </td>
          </tr>
        `;
      });

      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;

      document.getElementById('admin-content').innerHTML = html;
    }

    // Rentals Management
    function viewRentals() {
      setActiveButton('rentalsBtn');
      const rentals = getCurrentRentals();

      let html = `
        <div class="section-card">
          <div class="section-header">
            <h2>üìã Rental Management</h2>
          </div>
          <div class="section-content">
            <div class="search-filter">
              <input type="text" class="search-input" placeholder="Search rentals..." onkeyup="filterRentals(this.value)">
              <select class="filter-select" onchange="filterRentalsByStatus(this.value)">
                <option value="">All Status</option>
                <option value="ongoing">Ongoing</option>
                <option value="completed">Completed</option>
                <option value="returned">Returned</option>
              </select>
            </div>
      `;

      if (rentals.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p>No rentals found</p>
            <p style="font-size: 0.9rem; color: #9ca3af;">Rentals will appear here when customers make bookings</p>
          </div>
        `;
      } else {
        html += `
          <table id="rentalsTable">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Tool</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Duration</th>
                <th>Total Amount</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        rentals.forEach((rental, index) => {
          const duration = rental.duration || 'N/A';
          const amount = rental.totalAmount ? `Rs. ${rental.totalAmount.toLocaleString()}` : 'N/A';
          
          html += `
            <tr>
              <td>${rental.customerName || rental.customer}</td>
              <td>${rental.itemName || rental.item}</td>
              <td>${formatDate(rental.startDate)}</td>
              <td>${formatDate(rental.endDate)}</td>
              <td>${duration}</td>
              <td>${amount}</td>
              <td><span class="status-badge status-${rental.status}">${rental.status.charAt(0).toUpperCase() + rental.status.slice(1)}</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn-small btn-edit" onclick="updateRentalStatus(${index})">Update</button>
                  <button class="btn-small btn-delete" onclick="deleteRental(${index})">Delete</button>
                </div>
              </td>
            </tr>
          `;
        });

        html += `
            </tbody>
          </table>
        `;
      }

      html += `
          </div>
        </div>
      `;

      document.getElementById('admin-content').innerHTML = html;
    }

    // New Registrations
    function viewRegistrations() {
      setActiveButton('registrationsBtn');
      const registrations = getRegisteredUsers();

      let html = `
        <div class="section-card">
          <div class="section-header">
            <h2>üìù User Registrations</h2>
          </div>
          <div class="section-content">
      `;

      if (registrations.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <p>No new registrations</p>
            <p style="font-size: 0.9rem; color: #9ca3af;">User registrations will appear here</p>
          </div>
        `;
      } else {
        html += `
          <table>
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Registration Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
        `;

        registrations.forEach((user, index) => {
          html += `
            <tr>
              <td>${user.username}</td>
              <td>${user.email}</td>
              <td>${formatDate(new Date().toISOString())}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-small btn-edit" onclick="approveUser(${index})">Approve</button>
                  <button class="btn-small btn-delete" onclick="rejectUser(${index})">Reject</button>
                </div>
              </td>
            </tr>
          `;
        });

        html += `
            </tbody>
          </table>
        `;
      }

      html += `
          </div>
        </div>
      `;

      document.getElementById('admin-content').innerHTML = html;
    }

    // Action Functions (placeholder implementations)
    function editUser(username) {
      alert(`Edit user: ${username} (Feature coming soon)`);
    }

    function deleteUser(username) {
      if (confirm(`Are you sure you want to delete user: ${username}?`)) {
        alert(`User ${username} deleted (Feature coming soon)`);
      }
    }

    function editTool(toolId) {
      alert(`Edit tool ID: ${toolId} (Feature coming soon)`);
    }

    function deleteTool(toolId) {
      if (confirm(`Are you sure you want to delete this tool?`)) {
        alert(`Tool deleted (Feature coming soon)`);
      }
    }

    function updateRentalStatus(index) {
      alert(`Update rental status (Feature coming soon)`);
    }

    function deleteRental(index) {
      if (confirm(`Are you sure you want to delete this rental record?`)) {
        alert(`Rental deleted (Feature coming soon)`);
      }
    }

    function approveUser(index) {
      alert(`User approved (Feature coming soon)`);
    }

    function rejectUser(index) {
      if (confirm(`Are you sure you want to reject this registration?`)) {
        alert(`Registration rejected (Feature coming soon)`);
      }
    }

    // Filter Functions
    function filterUsers(searchTerm) {
      // Implementation for user filtering
      console.log('Filter users:', searchTerm);
    }

    function filterUsersByRole(role) {
      // Implementation for role filtering
      console.log('Filter by role:', role);
    }

    function filterTools(searchTerm) {
      // Implementation for tool filtering
      console.log('Filter tools:', searchTerm);
    }

    function filterToolsByCategory(category) {
      // Implementation for category filtering
      console.log('Filter by category:', category);
    }

    function filterRentals(searchTerm) {
      // Implementation for rental filtering
      console.log('Filter rentals:', searchTerm);
    }

    function filterRentalsByStatus(status) {
      // Implementation for status filtering
      console.log('Filter by status:', status);
    }

    // Logout function
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem("loggedUser");
        localStorage.removeItem("userType");
        window.location.href = "login.html";
      }
    }

    // Initialize admin panel
    window.addEventListener('load', function() {
      const loggedUser = localStorage.getItem('loggedUser');
      const userType = localStorage.getItem('userType');
      
      if (!loggedUser || userType !== 'admin') {
        alert('Access denied. Admin privileges required.');
        window.location.href = 'login.html';
        return;
      }

      // Show overview by default
      showOverview();
    });
  </script>
</body>
</html>